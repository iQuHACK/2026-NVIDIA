<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RyzzHoot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            min-height: 100vh;
            background: #1a0a2e;
            background-image: 
                radial-gradient(ellipse at top, #2d1b4e 0%, transparent 50%),
                radial-gradient(ellipse at bottom, #0f0520 0%, transparent 50%),
                radial-gradient(circle at 20% 80%, rgba(226, 27, 60, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(19, 104, 206, 0.15) 0%, transparent 40%);
            overflow-x: hidden;
            padding: 30px 20px;
        }

        .page-container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .logo {
            display: inline-block;
            position: relative;
        }

        .logo-main {
            font-size: 4em;
            font-weight: 900;
            letter-spacing: -3px;
            color: white;
            text-transform: uppercase;
            position: relative;
            display: inline-block;
        }

        .logo-main .ryzz {
            background: linear-gradient(180deg, #ffffff 0%, #a8a8a8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-main .hoot {
            background: linear-gradient(135deg, #e21b3c 0%, #ff4757 50%, #ff6b81 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120%;
            height: 120%;
            background: radial-gradient(ellipse, rgba(226, 27, 60, 0.4) 0%, transparent 70%);
            filter: blur(40px);
            z-index: -1;
        }

        .tagline {
            font-size: 0.85em;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 12px;
            text-transform: uppercase;
            margin-top: 8px;
        }

        /* Step Counter */
        .step-counter {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 35px;
        }

        .step-label {
            font-size: 0.9em;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .step-number {
            font-size: 2em;
            font-weight: 900;
            color: white;
            min-width: 80px;
            text-align: center;
        }

        .step-divider {
            font-size: 1.5em;
            color: rgba(255, 255, 255, 0.3);
        }

        /* Rankings Container */
        .rankings-wrapper {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .rankings {
            position: relative;
            min-height: 540px;
            overflow: hidden;
        }

        /* Rank Items */
        .rank-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-radius: 12px;
            position: absolute;
            width: 100%;
            left: 0;
            cursor: pointer;
            overflow: hidden;
            transform-origin: center;
        }

        .rank-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .rank-item:hover {
            filter: brightness(1.1);
        }

        .rank-badge {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4em;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(0, 0, 0, 0.25);
            border-radius: 10px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .distance-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 8px 14px;
            margin-right: auto;
            margin-left: 10px;
        }

        .distance-value {
            font-size: 1.6em;
            font-weight: 900;
            color: white;
            line-height: 1;
        }

        .distance-label {
            font-size: 0.6em;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 2px;
        }

        .bit-string {
            display: flex;
            gap: 6px;
            margin-left: auto;
        }

        .bit {
            width: 48px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6em;
            font-weight: 900;
            color: white;
            border-radius: 8px;
            position: relative;
            transition: transform 0.2s ease;
        }

        .bit.one {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 4px 15px rgba(255, 255, 255, 0.15);
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }

        .bit.zero {
            background: rgba(0, 0, 0, 0.3);
            color: rgba(255, 255, 255, 0.5);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Controls */
        .controls {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px 30px;
            backdrop-filter: blur(10px);
        }

        .timeline {
            position: relative;
            margin-bottom: 25px;
            padding: 10px 0;
        }

        .timeline-track {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            overflow: visible;
        }

        .timeline-progress {
            height: 100%;
            background: linear-gradient(90deg, #e21b3c 0%, #ff4757 100%);
            border-radius: 3px;
            width: 0%;
            position: relative;
            box-shadow: 0 0 20px rgba(226, 27, 60, 0.5);
            transition: width 0.3s ease;
        }

        .timeline-handle {
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3), 0 0 20px rgba(226, 27, 60, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .timeline-handle:hover {
            transform: translateY(-50%) scale(1.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 0 30px rgba(226, 27, 60, 0.5);
        }

        .button-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 28px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.85em;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #e21b3c 0%, #c41632 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(226, 27, 60, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(226, 27, 60, 0.5);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }

        .speed-select {
            padding: 12px 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.85em;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            outline: none;
        }

        .speed-select option {
            background: #1a0a2e;
            color: white;
        }

        /* Colors for ranks */
        .rank-1 { background: linear-gradient(135deg, #e21b3c 0%, #b8152f 100%); box-shadow: 0 8px 30px rgba(226, 27, 60, 0.4); }
        .rank-2 { background: linear-gradient(135deg, #1368ce 0%, #0d52a3 100%); box-shadow: 0 8px 30px rgba(19, 104, 206, 0.4); }
        .rank-3 { background: linear-gradient(135deg, #d89e00 0%, #b38200 100%); box-shadow: 0 8px 30px rgba(216, 158, 0, 0.4); }
        .rank-4 { background: linear-gradient(135deg, #26890c 0%, #1d6a09 100%); box-shadow: 0 8px 30px rgba(38, 137, 12, 0.4); }
        .rank-5 { background: linear-gradient(135deg, #ff6600 0%, #cc5200 100%); box-shadow: 0 8px 30px rgba(255, 102, 0, 0.4); }
        .rank-6 { background: linear-gradient(135deg, #9b59b6 0%, #7d4692 100%); box-shadow: 0 8px 30px rgba(155, 89, 182, 0.4); }

        .error {
            text-align: center;
            padding: 60px;
            font-size: 1.2em;
            color: #e21b3c;
            font-weight: 700;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.2s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, #2d1b4e 0%, #1a0a2e 100%);
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideUp 0.3s ease;
            position: relative;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 1.8em;
            font-weight: 900;
            color: white;
            margin-bottom: 10px;
        }

        .modal-subtitle {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
        }

        .flip-sequence {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .flip-step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .flip-step-header {
            font-size: 0.85em;
            font-weight: 700;
            color: #e21b3c;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .flip-step.target {
            border: 2px solid #26890c;
            background: rgba(38, 137, 12, 0.1);
        }

        .flip-step.target .flip-step-header {
            color: #26890c;
        }

        .flip-bits {
            display: flex;
            gap: 6px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .flip-bit {
            width: 42px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            font-weight: 900;
            font-size: 1.3em;
            border-radius: 6px;
            position: relative;
        }

        .flip-bit.changed {
            background: rgba(226, 27, 60, 0.3);
            border: 2px solid #e21b3c;
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .flip-bit.unchanged {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.4);
        }

        .flip-arrow {
            text-align: center;
            font-size: 1.5em;
            color: rgba(255, 255, 255, 0.3);
            margin: 5px 0;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .distance-badge {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .distance-badge:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.15);
        }

        /* Responsive */
        @media (max-width: 700px) {
            .logo-main { font-size: 2.5em; }
            .bit { width: 36px; height: 44px; font-size: 1.2em; }
            .rank-badge { width: 40px; height: 40px; font-size: 1.1em; }
            .btn { padding: 10px 18px; font-size: 0.75em; }
            .modal-content { padding: 30px 20px; }
            .flip-bit { width: 36px; height: 44px; font-size: 1.1em; }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <header class="header">
            <div class="logo">
                <div class="logo-glow"></div>
                <div class="logo-main">
                    <span class="ryzz">Ryzz</span><span class="hoot">Hoot</span>
                </div>
            </div>
            <div class="tagline">Quantum String Race</div>
        </header>

        <div class="step-counter">
            <span class="step-label">Step</span>
            <span class="step-number" id="currentTime">0</span>
            <span class="step-divider">/</span>
            <span class="step-number" id="maxTime">0</span>
        </div>

        <div class="rankings-wrapper">
            <div class="rankings" id="rankings"></div>
        </div>

        <div class="controls">
            <div class="timeline">
                <div class="timeline-track" id="timelineTrack">
                    <div class="timeline-progress" id="timelineProgress">
                        <div class="timeline-handle"></div>
                    </div>
                </div>
            </div>
            
            <div class="button-row">
                <button class="btn btn-primary" id="playPauseBtn" disabled>Play</button>
                <button class="btn btn-secondary" id="prevBtn" disabled>Prev</button>
                <button class="btn btn-secondary" id="nextBtn" disabled>Next</button>
                <button class="btn btn-secondary" id="resetBtn" disabled>Reset</button>
                <select class="speed-select" id="speedSelect">
                    <option value="1200">0.5x</option>
                    <option value="600" selected>1x</option>
                    <option value="300">2x</option>
                    <option value="150">4x</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="flipModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">✕</button>
            <div class="modal-header">
                <div class="modal-title">Bit Flip Path</div>
                <div class="modal-subtitle" id="modalSubtitle"></div>
            </div>
            <div class="flip-sequence" id="flipSequence"></div>
        </div>
    </div>

    <script>
        // Inline CSV data
        const csvData = `Time,String_1,String_2,String_3,String_4,String_5,String_6
0,0010111,1101000,0111101,0001011,1000010,1011110
1,0010111,1101000,0111101,0001011,1000010,1011110
2,0010111,1101000,0111101,0001011,1000010,1011110
3,0011111,1101000,0111101,0001011,1000010,1011110
4,0011111,1101000,0111101,0001011,1000010,1011110
5,0100111,1101000,0111101,0001011,1000010,1011110
6,0100111,1101000,0111101,0001011,1000010,1011110
7,0100111,1101000,0111101,0011011,1000010,1011110
8,0100111,1101000,0111101,0011011,1000010,1011110
9,0100111,1101000,0111101,0111011,1000010,1011110
10,0100111,1101000,0111101,0111011,1000010,1011110
11,0100111,1101000,0111101,0111011,1000010,1011110
12,0110111,1101000,0111101,0111011,1000010,1011110
13,0110111,1101000,0111101,0111011,1000010,1011110
14,0110111,1101000,0111101,0111011,1000010,1011110
15,0110111,1101000,0111101,0111011,1000010,1011110
16,0110111,1101000,0111101,0111011,1000010,1011110
17,0110111,1101000,0111101,0111011,1000010,1011110
18,0110111,1101000,0111101,0111011,1000010,1011110
19,0110111,1101000,0111101,0111011,1100010,1011110
20,0110111,1101000,0111101,0111011,1100010,1011110
21,0110111,1101000,0111101,0111011,1100010,1011110
22,0110111,1101000,0111101,0111011,1100010,1011110
23,0110111,1101000,0111101,0111011,1100010,1011110
24,0110111,1101000,0111101,0111011,1100010,1011110
25,0110111,1101000,0111101,1011011,1100010,1011110
26,0110111,1101000,0111101,1011011,1100010,1011110
27,0110111,1101000,0111101,1011011,1100010,1011110
28,0110111,1101000,0111101,1011011,1100010,1011110
29,0110111,1101000,0111101,1011011,1100010,1011110
30,0110111,1101000,0111101,1011011,1100010,1011110
31,0110111,1101000,0111101,1011011,1100010,1011110
32,0110111,1101000,0111101,1011011,1100010,1011110
33,0110111,1101000,0111101,1011011,1100010,1011110
34,0110111,1101000,1011101,1011011,1100010,1011110
35,0110111,1101000,1011101,1011011,1100010,1011110
36,0110111,1101000,1011101,1011011,1100010,1011110
37,0110111,1101000,1011101,1011011,1100010,1011110
38,0110111,1101000,1011101,1011011,1100010,1011110
39,0110111,1101000,1011101,1011011,1100010,1011110
40,0110111,1101000,1011101,1011011,1100010,1011110
41,0110111,1101000,1011101,1011011,1100010,1011110
42,1010111,1101000,1011101,1011011,1100010,1011110
43,1010111,1101000,1011101,1011011,1100010,1011110
44,1010111,1101000,1011101,1011011,1100010,1011110
45,1010111,1101000,1011101,1011011,1100010,1011110
46,1010111,1101000,1011101,1011011,1100010,1011110
47,1010111,1101000,1011101,1011011,1100010,1011110
48,1010111,1101000,1011101,1011011,1100010,1011110
49,1010111,1101000,1011101,1011011,1100010,1011110
50,1010111,1101000,1011101,1011011,1100010,1011110
51,1010111,1101000,1011101,1011011,1100010,1011110
52,1010111,1101000,1011101,1011011,1100010,1011110
53,1010111,1101000,1011101,1011011,1100010,1011110
54,1010111,1101000,1011101,1011011,1100010,1011110
55,1010111,1101000,1011101,1011011,1100010,1011110
56,1010111,1101000,1011101,1011011,1100010,1011110
57,1010111,1101000,1011101,1011011,1100010,1011110
58,1010111,1101000,1011101,1011011,1100010,1111110
59,1010111,1101000,1011101,1011011,1100010,1111110
60,1010111,1101000,1011101,1011011,1100010,1111110
61,1010111,1101000,1011101,1011011,1100010,1111110
62,1010111,1101000,1011101,1011011,1100010,1111110
63,1010111,1101000,1011101,1011011,1100010,1111110
64,1010111,1101000,1011101,1011011,1100010,1111110
65,1010111,1101000,1011101,1011011,1100010,1111110
66,1010111,1101000,1011101,1011011,1100010,1111110
67,1010111,1101000,1011101,1011011,1100010,1111110
68,1010111,1101000,1011101,1011011,1100010,1111110
69,1010111,1101000,1011101,1011011,1100010,1111110
70,1010111,1101000,1011101,1011011,1100010,1111110
71,1010111,1101000,1011101,1011011,1100010,1111110
72,1010111,1101000,1011101,1011011,1100010,1111110
73,1010111,1101000,1011101,1011011,1100010,1111110
74,1010111,1101000,1011101,1011011,1100110,1111110
75,1010111,1101000,1011101,1011011,1100110,1111110
76,1010111,1101000,1011101,1011011,1100110,1111110
77,1010111,1101000,1011101,1011011,1100110,1111110
78,1010111,1101000,1011101,1011011,1100110,1111110
79,1010111,1101000,1011101,1011011,1100110,1111110
80,1010111,1101000,1011101,1011011,1100110,1111110
81,1010111,1101000,1011101,1011011,1100110,1111110
82,1010111,1101000,1011101,1011011,1100110,1111110
83,1010111,1101000,1011101,1011011,1100110,1111110
84,1010111,1101000,1011101,1011011,1100110,1111110
85,1010111,1101000,1011101,1011011,1100110,1111110
86,1010111,1101000,1011101,1011011,1100110,1111110
87,1010111,1101100,1011101,1011011,1100110,1111110
88,1010111,1101100,1011101,1011011,1100110,1111110
89,1010111,1101100,1011101,1011011,1100110,1111110
90,1010111,1101100,1011101,1011011,1100110,1111110
91,1010111,1101100,1011101,1011011,1100110,1111110
92,1010111,1101100,1011101,1011011,1100110,1111110
93,1010111,1101100,1011101,1011011,1100110,1111110
94,1010111,1101100,1011101,1011011,1100110,1111110
95,1010111,1101100,1011101,1011011,1100110,1111110
96,1010111,1101100,1011101,1011011,1100110,1111110
97,1010111,1101100,1011101,1011011,1100110,1111110
98,1010111,1101100,1011101,1011011,1100110,1111110
99,1110111,1111100,1111101,1111011,1110110,1111110`;

        let data = [];
        let currentTimeIndex = 0;
        let isPlaying = false;
        let playInterval = null;
        let playSpeed = 600;
        const itemHeight = 90;
        let currentElements = {};

        // Target strings to compare against
        const targetStrings = [
            '1011000',
            '0100111',
            '0001101',
            '1110010'
        ];

        // Calculate Hamming distance (number of bit flips needed)
        function hammingDistance(str1, str2) {
            let distance = 0;
            const len = Math.max(str1.length, str2.length);
            const s1 = str1.padStart(len, '0');
            const s2 = str2.padStart(len, '0');
            for (let i = 0; i < len; i++) {
                if (s1[i] !== s2[i]) distance++;
            }
            return distance;
        }

        // Get minimum distance to any target
        function getMinDistance(value) {
            let minDist = Infinity;
            for (const target of targetStrings) {
                const dist = hammingDistance(value, target);
                if (dist < minDist) minDist = dist;
            }
            return minDist;
        }

        // Get closest target and distance
        function getClosestTarget(value) {
            let minDist = Infinity;
            let closestTarget = null;
            for (const target of targetStrings) {
                const dist = hammingDistance(value, target);
                if (dist < minDist) {
                    minDist = dist;
                    closestTarget = target;
                }
            }
            return { target: closestTarget, distance: minDist };
        }

        // Generate flip sequence from current to target
        function generateFlipSequence(current, target) {
            const sequence = [current];
            let temp = current.split('');
            
            for (let i = 0; i < current.length; i++) {
                if (current[i] !== target[i]) {
                    temp[i] = target[i];
                    sequence.push(temp.join(''));
                }
            }
            
            return sequence;
        }

        // Show flip modal
        function showFlipModal(value) {
            pause();
            
            const { target, distance } = getClosestTarget(value);
            const sequence = generateFlipSequence(value, target);
            
            document.getElementById('modalSubtitle').textContent = 
                `${distance} flip${distance !== 1 ? 's' : ''} needed to reach ${target}`;
            
            const sequenceContainer = document.getElementById('flipSequence');
            sequenceContainer.innerHTML = '';
            
            sequence.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = index === sequence.length - 1 ? 'flip-step target' : 'flip-step';
                
                const header = document.createElement('div');
                header.className = 'flip-step-header';
                if (index === 0) {
                    header.textContent = 'Current';
                } else if (index === sequence.length - 1) {
                    header.textContent = 'Target Reached';
                } else {
                    header.textContent = `Flip ${index}`;
                }
                stepDiv.appendChild(header);
                
                const bitsDiv = document.createElement('div');
                bitsDiv.className = 'flip-bits';
                
                for (let i = 0; i < step.length; i++) {
                    const bitDiv = document.createElement('div');
                    const prevStep = index > 0 ? sequence[index - 1] : null;
                    const changed = prevStep && prevStep[i] !== step[i];
                    
                    bitDiv.className = changed ? 'flip-bit changed' : 'flip-bit unchanged';
                    bitDiv.textContent = step[i];
                    bitDiv.style.color = step[i] === '1' ? '#4dffb8' : '#ff6b9d';
                    bitsDiv.appendChild(bitDiv);
                }
                
                stepDiv.appendChild(bitsDiv);
                sequenceContainer.appendChild(stepDiv);
                
                if (index < sequence.length - 1) {
                    const arrow = document.createElement('div');
                    arrow.className = 'flip-arrow';
                    arrow.textContent = '↓';
                    sequenceContainer.appendChild(arrow);
                }
            });
            
            document.getElementById('flipModal').classList.add('active');
        }

        // Close modal
        function closeFlipModal() {
            document.getElementById('flipModal').classList.remove('active');
        }

        function loadCSV() {
            try {
                parseCSV(csvData);
            } catch (error) {
                document.getElementById('rankings').innerHTML = 
                    '<div class="error">' + error.message + '</div>';
            }
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n').filter(line => line.trim() !== '');
            const headers = lines[0].split(',');
            const stringNames = headers.slice(1);

            data = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = line.split(',');
                if (values.length < 2) continue;

                const timeStep = {
                    time: parseInt(values[0]),
                    strings: []
                };

                for (let j = 1; j < values.length; j++) {
                    const val = values[j]?.trim();
                    if (!val) continue;
                    
                    timeStep.strings.push({
                        name: stringNames[j - 1],
                        value: val,
                        score: parseInt(val, 2)
                    });
                }

                timeStep.strings.sort((a, b) => b.score - a.score);
                data.push(timeStep);
            }

            document.getElementById('maxTime').textContent = data.length - 1;
            enableControls();
            renderTimeStep(0);
        }

        function enableControls() {
            document.getElementById('playPauseBtn').disabled = false;
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('prevBtn').disabled = false;
            document.getElementById('nextBtn').disabled = false;
        }

        function renderTimeStep(index) {
            currentTimeIndex = index;
            const timeStep = data[index];
            
            document.getElementById('currentTime').textContent = timeStep.time;
            
            const rankingsDiv = document.getElementById('rankings');
            const totalItems = timeStep.strings.length;
            rankingsDiv.style.height = (totalItems * itemHeight + 10) + 'px';
            
            const newElements = {};
            const maxRank = totalItems - 1;

            timeStep.strings.forEach((string, rank) => {
                const stringId = string.name;
                let rankItem = currentElements[stringId];
                const isNew = !rankItem;
                const oldRank = rankItem?._rank;
                const oldValue = rankItem?._value;
                const valueChanged = oldValue !== undefined && oldValue !== string.value;
                const isMovingDown = oldRank !== undefined && rank > oldRank;
                const isMovingUp = oldRank !== undefined && rank < oldRank;

                // If value changed, animate out the old one and create fresh
                if (valueChanged && rankItem) {
                    const oldElem = rankItem;
                    gsap.to(oldElem, {
                        y: totalItems * itemHeight + 100,
                        opacity: 0,
                        scale: 0.85,
                        duration: 0.4,
                        ease: 'power2.in',
                        onComplete: () => oldElem.remove()
                    });
                    rankItem = null;
                }

                const needsCreate = isNew || valueChanged;

                if (needsCreate) {
                    rankItem = document.createElement('div');
                    rankItem.className = 'rank-item';
                    rankItem.dataset.stringId = stringId;
                    rankingsDiv.appendChild(rankItem);
                    rankItem._currentY = (totalItems * itemHeight + 100);
                }

                const oldY = rankItem._currentY;
                const newY = rank * itemHeight;
                const moved = Math.abs(oldY - newY) > 1;
                
                rankItem._currentY = newY;
                rankItem._rank = rank;
                rankItem._value = string.value;

                const bits = string.value.split('').map(bit => 
                    `<div class="bit ${bit === '1' ? 'one' : 'zero'}">${bit}</div>`
                ).join('');

                const minDist = getMinDistance(string.value);

                rankItem.innerHTML = `
                    <div class="rank-badge">${rank + 1}</div>
                    <div class="distance-badge" data-value="${string.value}">
                        <div class="distance-value">${minDist}</div>
                        <div class="distance-label">flips</div>
                    </div>
                    <div class="bit-string">${bits}</div>
                `;
                
                // Add click listener to distance badge
                const distanceBadge = rankItem.querySelector('.distance-badge');
                distanceBadge.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showFlipModal(string.value);
                });

                rankItem.className = `rank-item rank-${rank + 1}`;
                rankItem.style.zIndex = 100 - rank;

                if (needsCreate) {
                    // Animate from bottom with glow effect
                    gsap.fromTo(rankItem, 
                        { y: totalItems * itemHeight + 100, scale: 0.85, opacity: 0 },
                        { 
                            y: newY, 
                            scale: 1, 
                            opacity: 1,
                            duration: 0.8,
                            ease: 'power2.out',
                            delay: valueChanged ? 0.3 : 0.1
                        }
                    );
                } else if (moved) {
                    const direction = isMovingDown ? 1 : -1;
                    gsap.to(rankItem, {
                        y: newY,
                        duration: 1.0,
                        ease: 'power2.inOut',
                    });
                    
                    gsap.fromTo(rankItem,
                        { scale: 1, x: 0 },
                        { 
                            scale: 1.03,
                            x: direction * 8,
                            duration: 0.15,
                            yoyo: true,
                            repeat: 1,
                            ease: 'power2.inOut'
                        }
                    );
                } else {
                    gsap.set(rankItem, { y: newY });
                }

                newElements[stringId] = rankItem;
            });

            Object.keys(currentElements).forEach(stringId => {
                if (!newElements[stringId]) {
                    const elem = currentElements[stringId];
                    // Exit to bottom
                    gsap.to(elem, {
                        y: totalItems * itemHeight + 100,
                        opacity: 0,
                        scale: 0.9,
                        duration: 0.5,
                        ease: 'power2.in',
                        onComplete: () => elem.remove()
                    });
                }
            });

            currentElements = newElements;
            updateProgressBar();
        }

        function updateProgressBar() {
            const progress = data.length > 1 ? (currentTimeIndex / (data.length - 1)) * 100 : 0;
            gsap.to('#timelineProgress', {
                width: progress + '%',
                duration: 0.3,
                ease: 'power2.out'
            });
        }

        function play() {
            if (isPlaying) return;
            isPlaying = true;
            document.getElementById('playPauseBtn').textContent = 'Pause';
            
            playInterval = setInterval(() => {
                if (currentTimeIndex < data.length - 1) {
                    renderTimeStep(currentTimeIndex + 1);
                } else {
                    pause();
                }
            }, playSpeed);
        }

        function pause() {
            isPlaying = false;
            document.getElementById('playPauseBtn').textContent = 'Play';
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
        }

        function reset() {
            pause();
            Object.values(currentElements).forEach(el => el.remove());
            currentElements = {};
            renderTimeStep(0);
        }

        // Find next timestep where any value changes
        function findNextFlip(fromIndex) {
            if (fromIndex >= data.length - 1) return fromIndex;
            
            const currentStep = data[fromIndex];
            const currentValues = {};
            currentStep.strings.forEach(s => {
                currentValues[s.name] = s.value;
            });
            
            for (let i = fromIndex + 1; i < data.length; i++) {
                const step = data[i];
                for (const string of step.strings) {
                    if (currentValues[string.name] !== string.value) {
                        return i;
                    }
                }
            }
            return data.length - 1;
        }

        // Find previous timestep where any value changes
        function findPrevFlip(fromIndex) {
            if (fromIndex <= 0) return 0;
            
            const currentStep = data[fromIndex];
            const currentValues = {};
            currentStep.strings.forEach(s => {
                currentValues[s.name] = s.value;
            });
            
            for (let i = fromIndex - 1; i >= 0; i--) {
                const step = data[i];
                for (const string of step.strings) {
                    if (currentValues[string.name] !== string.value) {
                        return i;
                    }
                }
            }
            return 0;
        }

        function next() {
            pause();
            const nextIndex = findNextFlip(currentTimeIndex);
            if (nextIndex !== currentTimeIndex) {
                renderTimeStep(nextIndex);
            }
        }

        function prev() {
            pause();
            const prevIndex = findPrevFlip(currentTimeIndex);
            if (prevIndex !== currentTimeIndex) {
                renderTimeStep(prevIndex);
            }
        }

        // Event Listeners
        document.getElementById('playPauseBtn').addEventListener('click', () => {
            isPlaying ? pause() : play();
        });

        document.getElementById('resetBtn').addEventListener('click', reset);
        document.getElementById('nextBtn').addEventListener('click', next);
        document.getElementById('prevBtn').addEventListener('click', prev);

        document.getElementById('speedSelect').addEventListener('change', (e) => {
            playSpeed = parseInt(e.target.value);
            if (isPlaying) {
                pause();
                play();
            }
        });

        document.getElementById('timelineTrack').addEventListener('click', (e) => {
            const bar = e.currentTarget;
            const rect = bar.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const percentage = clickX / rect.width;
            const newIndex = Math.round(percentage * (data.length - 1));
            
            pause();
            renderTimeStep(Math.max(0, Math.min(newIndex, data.length - 1)));
        });

        // Modal event listeners
        document.getElementById('modalClose').addEventListener('click', closeFlipModal);
        document.getElementById('flipModal').addEventListener('click', (e) => {
            if (e.target.id === 'flipModal') closeFlipModal();
        });

        loadCSV();
    </script>
</body>
</html>
